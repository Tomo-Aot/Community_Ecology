# Community Ecology

群集生態学用の解析手法を共有します。
ここに書いているスクリプトは R で使用することができます。


## Generalized Linear Model

faraway パッケージの付属データセット
gala を用いて、一般化線形モデルを作成します。
一般化線形モデルは解析手法としてあまり一般的なイメージはないですが、
ある 1 つの目的変数を説明する際に使われることがあります。
gala はガラパゴス諸島における生物種をまとめたデータセットです。
はじめに、島の大きさと生物種の関係について調べてみます。

<img src="https://raw.githubusercontent.com/Tomo-Aot/Community_Ecology/refs/heads/main/image/area_sp.png" width="400">

しかし、この図だと島の大きさと生物種の関係が分かりにくいです。
なので、島の大きさと生物種を常用対数に変換してみます。

<img src="https://raw.githubusercontent.com/Tomo-Aot/Community_Ecology/refs/heads/main/image/logrea_logsp.png" width = "400">

2つの変数を常用対数に変換するとわかりやすい。
この図を参考にモデルを作成しようと思います。
今回は、モデルの作成とその妥当性の検討を目的とします。

ここでは、正規分布を仮定した一般化線形モデルを作成します。
正規分布を仮定しているので一般線形モデルでも同じですが、
種数を扱う場合はポアソン分布も使う可能性があるので、
今回は一般化線形モデルを選択しています。

```
glm(log10(Species) ~ log10(Area), data = df, family = gaussian("identity"))
```

次に、作成したモデルの期待値を計算します。

```
pdata = expand(data = df,
       logarea = seq(min(log10(Area)), max(log10(Area)), length = 20))

tmp = predict(model, se.fit = TRUE, newdata = pdata) |> 
  as_tibble()
```




## Communities Dissimilarity

複数間の群集間の多様性は β 多様度 (Beta-Diversity)
といいます。
β 多様度は様々な指標で表され、
群集同士がどれくらい異なるか（もしくは似ているか）を計算します。
そのため、群集の非類似度 (Dissimilarity)
や類似度 (Similarity)
と呼ばれることもあります。

β 多様度は生息地間の多様性の指標でもあるため、
群集生態学における重要な要素です。

## Redundancy Analysis (RDA)

生態系において、生物データと環境要因の関係は重要な視点です。
温度や塩分などの環境要因は生物に生理学的・生態学的な影響を与えます。
しかし、生物群集のレベルで観察する際はそこまで簡単ではありません。
そこにいる生物の集団が温度によって決まっているとは限らないためです。
冗長性分析（Redundancy Analysis ; RDA）は生物群集と環境要因の相関関係を調べる解析手法です。

vegan の付属データセット dune を使用します。
これは Jongman et al. 1987 による砂丘の植生に関する群集データで、
20 地点における 30 種の植生のデータです。
種の行列は必ず標準化してから使用します。
群集生態学では、希少種に対する重みづけを減らすため、
Hellinger 距離に変換することが一般的です。
また、RDA を行う際は群集データの線形性を確かめる必要があります。
データの分布が線形であれば RDA や PCA 、山型であれば CA や CCA を使用するべきです。
今回は線形性の確認のために除歪対応分析（Detrended Correspondence Analysis；DCA）を使用しました。

環境要因は dune.env を使用します。
このデータセットは 5 つの環境要因を含みます。
それぞれの環境要因は以下の通りです。

・A1 … A1 層（土壌表層の有機物を含む層）の厚さの数値ベクトル

・Moisture … 水分量のレベル

・Management … 植生の管理基準（農業、保護区など）

・Use … 土地の使用

・Manure … 肥料のレベル

ただし、このデータは連続変数とカテゴリ変数が混在しているので、
そのまま使うことができません。
水分量と肥料は順序付けられた変数です。
カテゴリ変数はダミー変数に変換します。

データの準備が終わったら、モデルを構築します。
このとき、環境要因の多重共線性が検出された場合、その変数を除きます。
分散拡大係数（VIF）は多重共線性を検出します。
値が 10 を超えると多重共線性があると判断されます。
多重共線性が検出された変数は除きます。
今回は、多重共線性は検出されませんでした。
RDA の結果は使用した変数は植生の構成の 61.6 ％ を説明しました。
一般的には、 70 ％ 程度でかなり説明しており、
20 ％ を下回ると不適とされます。
この結果の場合、悪くはないのでそのまま次の検定に進みます。

正準軸と説明変数、
モデルの有意性は並べ替え検定（Permutation test）で調べます（α＝0.05）。
並び替えの回数は 999 回です。
このデータでは、
正準軸の有意性は、
正準軸 1 および正準軸 2 は有意でしたが、
それ以外の正準軸は有意ではありませんでした。
また、モデルの説明変数は、
A1 層の厚さと水分量、
土地の使用は有意でしたが、
管理基準と肥料レベルは有意ではありませんでした。

最後に RDA の結果を可視化します。
今回の解析結果では、
正準軸 1 と正準軸 2 が有意だったのでこちらを使用します。
今回は使用する正準軸の寄与率は 71 ％ ですが、
一般的には正準軸の寄与率の合計が 80 ％ 程度に達するまで正準軸を導入します。

## Permutational Analysis of Variance (PERMANOVA)


